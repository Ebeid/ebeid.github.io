---
title: "Python Notes 11 : Introduction to Network Programming"
date: '2009-05-15T03:00:00.001-05:00'

tags:
modified_time: '2009-05-15T04:48:15.361-05:00'
blogger_id: tag:blogger.com,1999:blog-59384554657271185.post-552760981910291874
blogger_orig_url: http://ebeid-soliman.blogspot.com/2009/05/python-notes-11-introduction-to-network.html
---

<p><font size="2"></font></p>  <p><strong><font size="2">Network Overview</font></strong></p>  <p><font size="2">Python provides a wide assortment of network support.</font></p>  <ul>   <li><font size="2">Low-level programming with sockets (if you want to create a protocol).</font></li>    <li><font size="2">Support for existing network protocols (HTTP, FTP, SMTP, etc...).</font></li>    <li><font size="2">Web programming (CGI scripting and HTTP servers).</font></li>    <li><font size="2">Data encoding</font></li> </ul>  <p><strong><font size="2">Network Basics: TCP/IP</font></strong></p>  <p><font size="2">Python’s networking modules primarily support TCP/IP.</font></p>  <ul>   <li><font size="2">TCP - A reliable connection-oriented protocol (streams).</font></li>    <li><font size="2">UDP - An unreliable packet-oriented protocol (datagrams).</font></li> </ul>  <p><font size="2">TCP is the most common (HTTP, FTP, SMTP, etc...). Both protocols are supported using &quot;sockets&quot;.</font></p>  <p><font size="2">A socket is a file-like object. Allows data to be sent and received across the network like a file. But it also includes functions to accept and establish connections. Before two machines can establish a connection, both must create a socket</font></p>  <p><strong><font size="2">Network Basics: Ports</font></strong></p>  <p><font size="2">In order to receive a connection, a socket must be bound to a port (by the server). A port is a number in the range 0-65535 that’s managed by the OS. Used to identify a particular network service (or listener). Ports 0-1023 are reserved by the system and used for common protocols:</font></p>  <ul>   <li><font size="2">FTP Port 20</font></li>    <li><font size="2">Telnet Port 23</font></li>    <li><font size="2">SMTP (Mail) Port 25</font></li>    <li><font size="2">HTTP (WWW) Port 80</font></li> </ul>  <p><font size="2">Ports above 1024 are reserved for user processes.</font></p>  <p><strong><font size="2">Socket programming in a nutshell</font></strong></p>  <ul>   <li><font size="2">Server creates a socket, binds it to some well-known port number, and starts listening.</font></li>    <li><font size="2">Client creates a socket and tries to connect it to the server (through the above port).</font></li>    <li><font size="2">Server-client exchange some data.</font></li>    <li><font size="2">Close the connection (of course the server continues to listen for more clients).</font></li> </ul>  <p><strong><font size="2">Socket Programming Example</font></strong></p>  <p><strong><font size="2">The socket module</font></strong></p>  <p><font size="2">Provides access to low-level network programming functions. The following example is a simple server that returns the current time</font></p>  <blockquote>   <p><font color="#0000ff" size="2">import time, socket</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">s = socket(AF_INET, SOCK_STREAM)#Create TCP socket</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">s.bind((&quot;&quot;,8888))&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #Bind to port 8888</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">s.listen(5)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #Start listening</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">while 1:</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">&#160;&#160;&#160; client,addr = s.accept()&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #Wait for a connection</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">&#160;&#160;&#160; print &quot;Got a connection from &quot;, addr</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">&#160;&#160;&#160; client.send(time.ctime(time.time())) #Send time back</font></p> </b
lockquote>  <blockquote>   <p><font color="#0000ff" size="2">&#160;&#160;&#160; client.close()</font></p> </blockquote>  <p><font size="2"><strong>Notes</strong>: The socket first opened by server is not the same one used to exchange data.Instead, the accept() function returns a new socket for this (’client’ above).listen() specifies max number of pending connections</font></p>  <p><font size="2">The following example is the client program for the above time server which connect to time server and get current time.</font></p>  <blockquote>   <p><font color="#0000ff" size="2">from socket import *</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">s = socket(AF_INET,SOCK_STREAM) #Create TCP socket</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">s.connect((&quot;google.com&quot;,8888))&#160;&#160;&#160;&#160;&#160;&#160; #Connect to server</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">tm = s.recv(1024)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #Receive up to 1024 bytes</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">s.close()&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Close connection</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">print &quot;The time is&quot;, tm</font></p> </blockquote>  <p><font size="2"><strong>Notes: </strong>Once connection is established, server/client communicate using send() and recv(). Aside from connection process, it’s relatively straightforward. Of course, the devil is in the details. And are there ever a LOT of details.</font></p>  <p><strong><font size="2">The Socket Module</font></strong></p>  <p><font size="2">The socket module used for all low-level networking, cr</font><font size="2">eation and manipulation of sockets, and g</font><font size="2">eneral purpose network functions (hostnames, data conversion, etc...). It’s a</font><font size="2"> direct translation of the BSD socket interface.</font></p>  <p><font size="2"><strong>Utility Functions</strong></font></p>  <ul>   <li><font color="#0000ff" size="2">socket.gethostbyname(hostname) # Get IP address for a host</font></li>    <li><font color="#0000ff" size="2">socket.gethostname() # Name of local machine</font></li>    <li><font color="#0000ff" size="2">socket.ntohl(x) # Convert 32-bit integer to host order</font></li>    <li><font color="#0000ff" size="2">socket.ntohs(x) # Convert 16-bit integer to host order</font></li>    <li><font color="#0000ff" size="2">socket.htonl(x) # Convert 32-bit integer to network order</font></li>    <li><font color="#0000ff" size="2">socket.htons(x) # Convert 16-bit integer to network order</font></li> </ul>  <p><font size="2"><strong>Comments: </strong></font><font size="2">Network order for integers is big-endian. </font><font size="2">Host order may be little-endian or big-endian (depends on the machine).</font></p>  <p><font size="2">The <font color="#0000ff">socket(family, type, proto)</font> function c</font><font size="2">reates a new socket object. <em>F</em></font><font size="2"><em>amily</em> is usually set to <font color="#0000ff">AF_INET</font><font color="#000000">. <em>T</em></font></font><font size="2"><em>ype</em> is one of:</font></p>  <ul>   <li><font size="2">SOCK_STREAM&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Stream socket (TCP)</font></li>    <li><font size="2">SOCK_DGRAM&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Datagram socket (UDP)</font></li>    <li><font size="2">SOCK_RAW&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Raw socket</font></li> </ul>  <p><font size="2"><em>Proto</em> is usually only used with raw sockets:</font></p>  <ul>   <li><font size="2">IPPROTO_ICMP</font></li>    <li><font size="2">IPPROTO_IP</font></li>    <li><font size="2">IPPROTO_RAW</font></li>    <li><font size="2">IPPROT
O_TCP</font></li>    <li><font size="2">IPPROTO_UDP</font></li> </ul>  <p><font size="2"></font></p>  <p><font size="2"><strong>Socket methods</strong></font></p>  <ul>   <li><font size="2">s.accept()&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Accept a new connection</font></li>    <li><font size="2">s.bind(address)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Bind to an address and port</font></li>    <li><font size="2">s.close()&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Close the socket</font></li>    <li><font size="2">s.connect(address)&#160;&#160;&#160;&#160;&#160; # Connect to remote socket</font></li>    <li><font size="2">s.fileno()&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Return integer file descriptor</font></li>    <li><font size="2">s.getpeername()&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Get name of remote machine</font></li>    <li><font size="2">s.getsockname()&#160;&#160;&#160; #Get socket address as (ipaddr,port)</font></li>    <li><font size="2">s.getsockopt(...)&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Get socket options</font></li>    <li><font size="2">s.listen(backlog)&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Start listening for connections</font></li>    <li><font size="2">s.makefile(mode)&#160;&#160; # Turn socket into a file like object</font></li>    <li><font size="2">s.recv(bufsize)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Receive data</font></li>    <li><font size="2">s.recvfrom(bufsize)&#160;&#160;&#160; # Receive data (UDP)</font></li>    <li><font size="2">s.send(string)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Send data</font></li>    <li><font size="2">s.sendto(string, address)&#160;&#160;&#160; # Send packet (UDP)</font></li>    <li><font size="2">s.setblocking(flag)&#160;&#160; #Set blocking or nonblocking mode</font></li>    <li><font size="2">s.setsockopt(...)&#160;&#160;&#160;&#160;&#160; #Set socket options</font></li>    <li><font size="2">s.shutdown(how)&#160;&#160;&#160;&#160; #Shutdown one or both halves of connection</font></li> </ul>  <p><font size="2">There are a huge variety of configuration/connection options. </font><font size="2">You’ll definitely want a good reference at your side</font></p>  <p><font size="2"><strong>The SocketServer Module</strong></font></p>  <p><font size="2">Provides a high-level class-based interface to sockets. E</font><font size="2">ach protocol is e<font size="2">ncapsulated </font>in a class (TCPServer, UDPServer, etc.). It also p</font><font size="2">rovides a series of handler classes that specify additional server behavior.</font></p>  <p><font size="2">To create a network service, need to inherit from both a protocol and handler class. </font><font size="2">Example, the same time server we done before:</font></p>  <blockquote>   <p><font color="#0000ff" size="2">import SocketServer</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">import time</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2"># This class actually implements the server functionality</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">class TimeHandler(SocketServer.BaseRequestHandler):</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">&#160;&#160;&#160; def handle(self):</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.request.send(time.ctime(time.time()))</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2"># Create the server</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">server = SocketServer.TCPServer(&quot;&quot;,8888),TimeHandler)</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">server.serve_forever()</font></p> </blockquote>  <p><font size="2"><strong>Not
es: </strong></font><font size="2">The module provides a number of specialized server and handler types. </font><font size="2">Ex: ForkingTCPServer, ThreadingTCPServer, StreamRequestHandler, etc.</font></p>  <p><font size="2"><strong>Common Network Protocols</strong></font></p>  <p><font size="2">Modules are available for a variety of network protocols:</font></p>  <ul>   <li><font size="2">ftplib&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; FTP protocol</font></li>    <li><font size="2">smtplib&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; SMTP (mail) protocol</font></li>    <li><font size="2">nntplib&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; News</font></li>    <li><font size="2">gopherlib&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Gopher</font></li>    <li><font size="2">poplib&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; POP3 mail server</font></li>    <li><font size="2">imaplib&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; IMAP4 mail server</font></li>    <li><font size="2">telnetlib&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Telnet protocol</font></li>    <li><font size="2">httplib&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; HTTP protocol</font></li> </ul>  <p><font size="2">These modules are built using sockets, but operate on a very low-level. Working with them r</font><font size="2">equires a good understand of the underlying protocol. </font><font size="2">But can be quite powerful if you know exactly what you are doing</font></p>  <p><font size="2"><strong>The httplib Module</strong></font></p>  <p><font size="2">Implements the HTTP 1.0 protocol and c</font><font size="2">an use to talk to a web server.</font></p>  <p><font size="2">HTTP in two bullets:</font></p>  <ul>   <li><font size="2">Client (e.g., a browser) sends a request to the server</font></li> </ul>  <blockquote>   <p><font size="2">GET /index.html HTTP/1.0</font></p> </blockquote>  <blockquote>   <p><font size="2">Connection: Keep-Alive</font></p> </blockquote>  <blockquote>   <p><font size="2">Host: </font><a href="http://www.python.org"><font size="2">www.python.org</font></a></p> </blockquote>  <blockquote>   <p><font size="2">User-Agent: Mozilla/4.61 [en] (X11; U; SunOS 5.6 sun4u)</font></p> </blockquote>  <blockquote>   <p><font size="2">[blank line]</font></p> </blockquote>  <ul>   <li><font size="2">Server responds with something like this:</font></li> </ul>  <blockquote>   <p><font size="2">HTTP/1.0 200 OK</font></p> </blockquote>  <blockquote>   <p><font size="2">Content-type: text/html</font></p> </blockquote>  <blockquote>   <p><font size="2">Content-length: 72883</font></p> </blockquote>  <blockquote>   <p><font size="2">Headers: blah</font></p> </blockquote>  <blockquote>   <p><font size="2">[blank line]</font></p> </blockquote>  <blockquote>   <p><font size="2">Data</font></p> </blockquote>  <blockquote>   <p><font size="2">...</font></p> </blockquote>  <p><font size="2"><strong>Making an HTTP connection</strong></font></p>  <blockquote>   <p><font color="#0000ff" size="2">import httplib</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">h = httplib.HTTP(&quot;www.python.org&quot;)</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">h.putrequest(’GET’,’/index.html’)</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">h.putheader(’User-Agent’,’Lame Tutorial Code’)</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">h.putheader(’Accept’,’text/html’)</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">h.endheaders()</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">errcode,errmsg, headers = h.getreply()</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">f = h.getfile()&#160;&#160;&#160;&#160;&#160;&#160;&#160; # G
et file object for reading data</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">data = f.read()</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">f.close()</font></p> </blockquote>  <p><font size="2">You should understand some HTTP to work with httplib.</font></p>  <p><font size="2"><strong>The urllib Module</strong></font></p>  <p><font size="2">A high-level interface to HTTP and FTP which p</font><font size="2">rovides a file-like object that can be used to connect to remote servers</font></p>  <blockquote>   <p><font color="#0000ff" size="2">import urllib</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">f = urllib.urlopen(&quot;http://www.python.org/index.html&quot;)</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">data = f.read()</font></p> </blockquote>  <blockquote>   <p><font color="#0000ff" size="2">f.close()</font></p> </blockquote>  <p><font size="2"><strong>Utility functions</strong></font></p>  <ul>   <li><font size="2">urllib.quote(str)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Quotes a string for use in a URL</font></li>    <li><font size="2">urllib.quote_plus(str)&#160;&#160;&#160; # Also replaces spaces with ’+’</font></li>    <li><font size="2">urllib.unquote(str)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # Opposite of quote()</font></li>    <li><font size="2">urllib.unquote_plus(str)&#160; # Opposite of quote_plus()</font></li>    <li><font size="2">urllib.urlencode(dict) </font></li>    <li><font size="2"># Turns a dictionary of key=value</font><font size="2"> pairs into a HTTP query-string</font></li> </ul>  <p><font size="2">Examples</font></p>  <p><font color="#0000ff" size="2">urllib.quote(&quot;ebeid@ieee&quot;)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #Produces &quot;ebeid%40ieee&quot;</font></p>  <p><font color="#0000ff" size="2">urllib.unquote(&quot;%23%21/bin/sh&quot;)&#160;&#160;&#160; #Produces &quot;/bin/sh&quot;</font></p>  <p><font size="2"><strong>The urlparse Module</strong></font></p>  <p><font size="2">Contains functions for manipulating URLs</font></p>  <ul>   <li><font size="2">URL’s have the following general format</font></li> </ul>  <blockquote>   <p><font size="2">scheme:/netloc/path;parameters?query#fragment</font></p> </blockquote>  <ul>   <li><font size="2">urlparse(urlstring) - Parses a URL into components</font></li> </ul>  <blockquote>   <p><font size="2">import urlparse</font></p> </blockquote>  <blockquote>   <p><font size="2">t = urlparse.urlparse(&quot;http://www.python.org/index.html&quot;)</font></p> </blockquote>  <blockquote>   <p><font size="2">#Produces (’http’,’</font><a href="http://www.python.org&rsquo;,&rsquo;/index.html"><font size="2">www.python.org’,’/index.html</font></a><font size="2">’,’’,’’,’’)</font></p> </blockquote>  <ul>   <li><font size="2">urlunparse(tuple) - Turns tuple of components back into a URL string</font></li> </ul>  <blockquote>   <p><font size="2">url = urlparse.urlunparse((’http’,’www.python.org’,’foo.html’, </font><font size="2">’bar=spam’,’’))</font></p> </blockquote>  <blockquote>   <p><font size="2"># Produces &quot;</font><a href="http://www.python.org/foo.html?bar=spam"><font size="2">http://www.python.org/foo.html?bar=spam</font></a><font size="2">&quot;</font></p> </blockquote>  <ul>   <li><font size="2">urljoin(base, url) - Combines a base and relative URL</font></li> </ul>  <blockquote>   <p><font size="2">urlparse.urljoin(&quot;http://www.python.org/index.html&quot;,&quot;help.html&quot;)</font></p> </blockquote>  <blockquote>   <p><font size="2"># Produces &quot;</font><a href="http://www.python.org/help.html"><font size="2">http://www.python.org/help.html</font></a><font size="2">&quot;</font></p> </blockquote>  <p><font size="2"></font></p>  <p><font size="2">In this note we explored horizontally the network programming capabilities of Python. Every single module and topic mentioned here, needs multiple posts to cover it. In the upcoming posts, we
will dig into network programming in detail.</font></p>

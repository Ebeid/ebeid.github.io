
<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta http-equiv="X-UA-Compatible" content="ie=edge"/>
<meta name="theme-color" content="#478079" >



<title>Ebeid ElSayed | Product Manager</title>
<meta name="description" content='Ebeid ElSayed | Product Manager | Personal Site.'>


<style data-generator="critical-css">

</style>



    
        
        
    

    
        
        
    

    
        
        
    

  
  
  
  
  <link rel="stylesheet" href="http://localhost:1313/css/menu.6e233ea8020133c8fdf840fc9876a529cacbe674c7d8193cc12963d7eb29f253.css" integrity="sha256-biM&#43;qAIBM8j9&#43;ED8mHalKcrL5nTH2Bk8wSlj1&#43;sp8lM=">







 


<link
  rel="preload"
  href="/css/bundle.css"
  as="style"
  data-generator="purgeCSS"
  onload="this.onload=null;this.rel='stylesheet'"
  
/>
<noscript>
  <link 
    rel="stylesheet" 
    href="/css/bundle.css"
    
  />
</noscript>



<script src='http://localhost:1313/js/library/lozad.min.js'></script>

 

  </head>

  <body>
    

<header class="header fixed-top rad-animation-group" id="header">
  <div class="container rad-fade-in">
    <nav class="navbar navbar-expand-lg navbar-light p-0">
      <div class="container-fluid">
        <a class="navbar-brand mx-auto" href="http://localhost:1313/">
          <span>Ebeid</span>
          <span>ElSayed</span>
        </a>
        <button
          class="navbar-toggler collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent, #header"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-lg-auto">
            <li class="nav-item">
              <a class="nav-link active" href="http://localhost:1313/">HOME</a>
            </li>
            
            <li class="nav-item">
              <a data-scroll class="nav-link" href="/#about"
                >ABOUT</a
              >
            </li>
            
            <li class="nav-item">
              <a data-scroll class="nav-link" href="/#portfolio"
                >PORTFOLIO</a
              >
            </li>
            
            <li class="nav-item">
              <a data-scroll class="nav-link" href="/blog"
                >BLOG</a
              >
            </li>
            
            <li class="nav-item">
              <a data-scroll class="nav-link" href="/#contact"
                >CONTACT</a
              >
            </li>
            
          </ul>
        </div>
      </div>
    </nav>
  </div>
</header>


<section id="breadcrumb-bar" class="breadcrumb-bar container">
        <ul class="breadcrumbs">
            <li class="breadcrum-item"><span><a href="/">Home</a></span></li><li class="breadcrum-item"><span><a href="/blog">Blog</a></span></li><li class="breadcrum-item current">The Z3 Constraint Solver, a developer perspective</li></ul>
</section>


    <section
      id="blog-single"
      class="section section--border-bottom rad-animation-group"
    >
      <div class="container">
        <h1><a href="/blog/2013-07-30-the-z3-constraint-solver-developer.html/">The Z3 Constraint Solver, a developer perspective</a></h1>

        <aside id="meta" class="light-border-bottom">
          <div>
            <section>
              Published en
              <h4 id="date">Tue Jul 30, 2013</h4>
              ·
              <h4 id="wordcount">670 Words</h4>
            </section>
             
            <ul id="tags">
              
              <li><a href="/tags/z3/">Z3</a></li>
              
              <li><a href="/tags/satiability-modulo-theories/">Satiability Modulo Theories</a></li>
              
            </ul>
            
          </div>
        </aside>

        <div class="row flex-column-reverse flex-md-row rad-fade-down">
          <div class="col-12"><p><a href="http://research.microsoft.com/en-us/um/redmond/projects/z3/old/" title="Z3 : An Efficient Theorem Prover">Z3</a>
is a high-performance SMT solver developed at <a href="http://research.microsoft.com/en-us/" title="Microsoft Research">Microsoft
Research</a>. It
have been integrated with many many tools that came out from Microsoft
for program analysis, testing, and verification.</p>
<h4 id="what-sat-means-">What SAT means ?</h4>
<p>SAT refers to Boolean satisfiability problem where we want to determine
if there exists an interpretation that satisfies a given Boolean
formula. In other words, it establishes if the variables of a given
Boolean formula can be assigned in such a way as to make the formula
evaluate to true.</p>
<h4 id="what-smt-means-">What SMT means ?</h4>
<p>SMT stands for Satiability Modulo Theories. SMT instance is a formula in
first-order logic, where some functions and predicates have additional
interpretations. SMT problem is a decision problem of determining
whether such a formula is satisfiable or not.</p>
<p>An SMT instance is a generalization of a Boolean SAT instance in which
various sets of variables are replaced by predicates over a suitable set
of non-binary variables.</p>
<p>These predicates are classified according to the theory they belong to.
For instance, linear inequalities over real variables are evaluated
using the rules of the theory of linear real arithmetic.</p>
<h4 id="what-smt-solver-means-">What SMT solver means ?</h4>
<p>The goal of an SMT solver is to determine whether an SMT instance can
evaluate to true or not. The same analog applies for SAT solvers.</p>
<h4 id="smt-solvers">SMT solvers</h4>
<p>There is a lot of SMT solvers available but there is only one SMT solver
with C# APIs, it is Z3. For a list of available SMT solvers, refer to
this
<a href="http://en.wikipedia.org/wiki/Satisfiability_Modulo_Theories" title="Satisfiability Modulo Theories">page</a>.</p>
<h4 id="download-z3">Download Z3</h4>
<p>You can download Z3 from <a href="http://z3.codeplex.com/">http://z3.codeplex.com/</a> . I downloaded Z3
4.3.0 and extracted it to C:\z3.</p>
<h4 id="c-example">C# Example</h4>
<p>In the following example we going to let Z3 solve the following equation
system:</p>
<ul>
<li>x &gt; 0</li>
<li>y = x + 1 </li>
<li>y &lt; 3</li>
</ul>
<p>Solving the equations means finding values for x and y that make the
whole formula evaluates to true.</p>
<ul>
<li>Let’s create a new console application project in Visual Studio.</li>
<li>Add reference to <em>Microsoft.Z3.dll</em> which is located in the bin
directory of the Z3 installation directory.</li>
<li>Copy the file libz3.dll from the bin directory of the Z3
installation directory to your project build directory.</li>
<li>Now edit your code to look like the following:</li>
</ul>
<!-- raw HTML omitted -->
<pre><code>using System;
using Microsoft.Z3;

namespace Z3Demo1
{
    class Program
    {
        static void Main(string[] args)
        {
            using (Context ctx = new Context())
            {
                Expr x = ctx.MkConst(&quot;x&quot;, ctx.MkIntSort());
                Expr y = ctx.MkConst(&quot;y&quot;, ctx.MkIntSort());
                Expr zero = ctx.MkNumeral(0, ctx.MkIntSort());
                Expr one = ctx.MkNumeral(1, ctx.MkIntSort());
                Expr three = ctx.MkNumeral(3, ctx.MkIntSort());
                
                Solver s = ctx.MkSolver();
                s.Assert(ctx.MkAnd(ctx.MkGt((ArithExpr)x, (ArithExpr)zero), ctx.MkEq((ArithExpr)y, 
                    ctx.MkAdd((ArithExpr)x, (ArithExpr)one)), ctx.MkLt((ArithExpr)y, (ArithExpr)three)));
                Console.WriteLine(s.Check());

                Model m = s.Model;
                foreach (FuncDecl d in m.Decls)
                        Console.WriteLine(d.Name + &quot; -&gt; &quot; + m.ConstInterp(d));
                    
                Console.ReadLine();
            }
        }
    }
}
</code></pre>
<p>Now let’s run the code above and see the output. The solver says the
equation system is satisfiable and then gives us the x and y values that
satisfy.</p>
<p><img alt="alt text" src="/img/0015.png" title="Logo Title Text 1"></p>
<h4 id="how-it-works-">How it works ?</h4>
<p>To interact with Z3 through C#, you need a
<a href="http://research.microsoft.com/en-us/um/redmond/projects/z3/class_microsoft_1_1_z3_1_1_context.html" title="Context Class Reference">Context</a>
object. Variables and numerals in your equations are modeled as
<a href="http://research.microsoft.com/en-us/um/redmond/projects/z3/class_microsoft_1_1_z3_1_1_expr.html" title="Expr Class Reference">Expr</a>
objects. You get these objects using member functions in the Context
object (MkConts(), MkNumeral(),….). You construct your operand using
member functions in the Context object (MkGt(), MkAdd(), MkLt(),…). To
solve all the equations together you need to hock them up using AND
operator, which is implemented using Context.MkAnd(). After hocking
everything in one AND, you pass that the solver through
<a href="http://research.microsoft.com/en-us/um/redmond/projects/z3/class_microsoft_1_1_z3_1_1_solver.html" title="Solver Class Reference">Solver</a>.Assert().
And as you may guessed, you obtain this Solver using Context.MkSolver().</p>
<p>Solver.Check() will tell you whether this equation system can be solved
or not. To get the variables’ assignments that the come up with, get a
Model object Solver.Model. Then use the Delcs collection to get all
symbols that have an interpretation in the model. Model.ConstInterp()
will get the symbol assigned value.</p>
<p>In this post we briefly introduced SAT, SMT, and their solvers. Then we
explored the only SMT solver that written in C# and had a C# API. Now
you can play with as many equations as you want and check them for
satisfiability and even got the solution values.</p>
</div>
        </div>

        <aside class="content-browser light-border-top">
            Continue reading
            <div>
                
                    <a class="previous" href="/blog/2013-07-24-get-path-conditions-from-microsoft-pex.html/">↩ Get path conditions from Microsoft Pex</a>
                
                 ■ 
                
                    <a class="next" href="/blog/2013-08-01-convert-microsoft-pex-path-conditions.html/"> Convert Microsoft Pex path conditions from Z3 native format to SMT-LIB ↪</a>
                
            </div>
        </aside>
      </div>
    </section>

    <footer class="footer">
  <div class="container">
    <div class="footer__left">
      <div class="footer__copy">
        © Adritian. Free Hugo theme by Adrián Moreno Peña.
      </div>
    </div>
    <div class="footer__links">
      <ul class="navbar-nav ">
        <li class="nav-item">
            <a class="nav-link" href="http://localhost:1313/">🏠 HOME</a>
        </li>
        
        <li class="nav-item">
          <a class="nav-link" href="/#about">ABOUT</a>
        </li>
        
        <li class="nav-item">
          <a class="nav-link" href="/#portfolio">PORTFOLIO</a>
        </li>
        
        <li class="nav-item">
          <a class="nav-link" href="/#contact">CONTACT</a>
        </li>
        
      </ul>
    </div>
    <div class="footer__right">
      
      <nav class="language-selector">
        <ul>
          
            
            <li class="dropdown">
              <button type="button" class="dropdown__title" aria-expanded="false" aria-controls="languages-dropdown">
                <span class="label">Language</span>    
              </button>
            <ul class="dropdown__menu" id="languages-dropdown">
              <li class="current"><span>✔️ English</span></li>
              
              
            
              
            
              
              
            </ul>
          </li>
        </ul>
      </nav>
      
    </div>
  </div>
</footer>
 <script>
  window.addEventListener("load", function() {
    try{
      var observer = window.lozad(".lozad", {
        rootMargin: window.innerHeight / 2 + "px 0px",
        threshold: 0.01
      }); 
      observer.observe();
    } catch(e) {
      console.error(e);
    }
  });
</script>
<script defer src='http://localhost:1313/js/rad-animations.js'></script>
<script defer src='http://localhost:1313/js/library/smooth-scroll.polyfills.min.js'></script>
<script defer src='http://localhost:1313/js/sticky-header.js'></script>
<script defer src='http://localhost:1313/js/smooth-scroll-init.js'></script>
<script defer src='http://localhost:1313/js/library/bootstrap.min.js'></script>





<script>
  window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
</script>



  </body>
</html>


---
layout: post
title: Microsoft Dynamics CRM 2011 for Developers | Accessing Microsoft Dynamics CRM
  2011 using WCF
date: '2012-03-02T16:28:00.001-06:00'
author: Ebeid Soliman ElSayed
tags:
- Microsoft Dynamics CRM 2011
- Early Binding
- Late Binding
- WCF
modified_time: '2012-03-22T15:34:21.003-05:00'
thumbnail: http://lh4.ggpht.com/-ErYqt2kO-Ac/T1f6zwhR_QI/AAAAAAAAALo/QHswC5-7308/s72-c/app_thumb1.jpg?imgmax=800
blogger_id: tag:blogger.com,1999:blog-59384554657271185.post-3652094204300492925
blogger_orig_url: http://ebeid-soliman.blogspot.com/2012/03/accessing-microsoft-dynamics-crm-2011.html
---

<h4>Contents</h4>  <ol>   <li>Introduction </li>    <li>Creating a client application </li>    <li>Using the Discovery Service </li>    <li>Using the Organization Service </li>    <li>Working with CRM Data      <ol>       <li>Late Binding Approach          <ol>           <li>Using RetrieveMultiple method </li>            <li>Using Retrieve method </li>            <li>Using Update method </li>            <li>Using Delete method </li>            <li>Using Create method </li>         </ol>       </li>        <li>Early binding Approach          <ol>           <li>generating Client Types </li>            <li>Enable ProxyTypeBehavior </li>            <li>Using RetrieveMultiple method </li>            <li>Using Retrieve method </li>            <li>Using Create method </li>         </ol>       </li>     </ol>   </li> </ol>  <h3>Introduction</h3>  <p><b>Microsoft Dynamics CRM</b> is a Customer Relationship Management software package developed to focus mainly on Sales, Marketing, and Service (help desk) sectors. The Microsoft Dynamics family of business applications includes other related products such as Microsoft Dynamics AX, Microsoft Dynamics GP, Microsoft Dynamics NAV, and Microsoft Dynamics SL.</p>  <p>Basically, Dynamics CRM is a client-server web application that supports extensive web services interfaces. Dynamics CRM 2011 introduces a new WCF interface for working with data, services and metadata.</p>  <p>Microsoft Dynamics CRM supports two kinds of deployments: Online, on-premises. You can signup for 30 days free trial at <a title="http://crm.dynamics.com/en-us/trial-overview" href="http://crm.dynamics.com/en-us/trial-overview">http://crm.dynamics.com/en-us/trial-overview</a>. This will provide you with 30 days full functioning online version of Dynamics CRM. We will you this version in this post and the upcoming posts.</p>  <p>There is a lot of situations where organizations want to gain more benefit of its Dynamics CRM deployment than what Dynamics CRM can offer through its built-in customization tools. Based on the situation, you as a developer may be required to develop applications that interact with Dynamics CRM through its web services interfaces or develop applications that run within Dynamics CRM itself.</p>  <p>In this post we will explore one of the techniques of interacting with Dynamics CRM through its web services interfaces. We will build a windows forms application that connects to the online version of Dynamics CRM 2011, retrieve data from it, and manipulate its data. To continue with this post you need to signup for an online trial version and to install Microsoft Dynamics CRM 2011 Software Development Kit (SDK) ( download from <a href="http://www.microsoft.com/download/en/details.aspx?id=24004">http://www.microsoft.com/download/en/details.aspx?id=24004</a> )</p>  <p><strong>Step 1: Create a client application</strong> </p>  <p>Simply create a new windows forms application. Right click your project in the solution explorer and select properties, locate the Target Framework drop down and change it from .Net Framework 4 Client Profile to .Net Framework 4. Add references to <em>System.Runtime.Serialization.dll</em> and<em> System.ServiceModel.dll</em> and<em> System.Security. </em>Add references to <em>Microsoft.Xrm.Sdk.dll</em> and <em>Microsoft.Crm.Sdk.Proxy.dll </em>(both files located in the Bin folder in your CRM SDK installation directory). Right click on the project in the solution explorer and click Add existing, browse to %CRMSDK%\samplecode\cs\helpercode\deviceidmanager.cs</p>  <p>The DeviceIdManager class is included in the Dynamics CRM SDK to register a computing device with Windows Live ID through the generation of a Device ID and password. Then it optionally stores that information in an encrypted format on the local disk for later use. This functionality is required when authenticating with Microsoft Dynamics CRM online. The device registration is stored in %USERPROFILE%\LiveDeviceID\LiveDevice.xml. It looks like:</p>  <pre class="brush: xml">&lt;?xml version=&quot;1.0&quot;?&gt;<br /><data version="1"><br />  <user type="Logical" username="denl276oo3fgxbakccnnq2x4"><br /><pwd>AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAooZFtct7dEyyPUNu1eZujgAAAAACAAAAAAADZgAAqAAAABAAAAD0860vIxbs57z9CgRRPAtTAAAAAASAAACgAAAAEAAAAFL9eqV3G5WLFhHYAkX1/z8gAAAAZjBYCltk8cNwuydeQK70t9/txdmoJhIGeN2StJbyx9EUAAAAY10YU7QprX0EO5Fq43A/S2Wer2I=</pwd><br />  </user><br /></data></pre><br /><br /><p>The CRM SDK team is separating the more CRM specific types from the xRM Application Framework related types.&#160; The Microsoft.Xrm.Sdk assembly will provide all the low-level types necessary for basic operation against the xRM Application Framework. The Microsoft.Crm.Sdk.Proxy.dll&#160; assembly will abstract away much of the complexity of dealing with the WCF services directly.</p><br /><br /><p>Now, try to make your application interface like the one in the image below.</p><br /><br /><p><a href="http://lh6.ggpht.com/-kHmVhKSR0uA/T1f6zZ4t-qI/AAAAAAAAALg/LQWWR6L4Lks/s1600-h/app3.jpg"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="app" border="0" alt="app" src="http://lh4.ggpht.com/-ErYqt2kO-Ac/T1f6zwhR_QI/AAAAAAAAALo/QHswC5-7308/app_thumb1.jpg?imgmax=800" width="505" height="411" /></a></p><br /><br /><p>Now we created the application interface, added the required references, and ready for the real thing :)</p><br /><br /><p><strong>Step 2: Using the Discovery Service</strong></p><br /><br /><p>The discovery service allows you to explore and enumerate the organizations on a certain CRM server and the web services endpoint URL needed to access the Organization Services web service for each of these organizations (The CRM server can contain multiple organizations). We will use this information later to configure the organization web service proxy and call web service methods to access the organization’s data and metadata. The service respects security such that it will only return those organizations to which a user has access. The discovery service is accessed using methods on the <strong>IDiscoveryService</strong> interface. The <strong>DiscoveryServiceProxy </strong>class is a helper class to make it easier to get instances of <strong>IDiscoveryService </strong>without having to deal with all the WCF low-level details.</p><br /><br /><p>Now on the forms designer surface double click on the Discover button to add event handler and open the MainWindow.xaml.cs code behind file. In the code behind, add the following using statements:</p><br /><br /><pre class="brush: csharp">using Microsoft.Xrm.Sdk;<br />using Microsoft.Xrm.Sdk.Client;<br />using Microsoft.Xrm.Sdk.Discovery;<br />using System.ServiceModel.Description;<br />using Microsoft.Crm.Services.Utility;<br />using Microsoft.Xrm.Sdk.Query;<br />using Microsoft.Xrm.Sdk.Messages;</pre><br /><br /><p>Inside the frmMain class, add the following private properties to hold references to the organization details (the Discovery service and the Organization service).</p><br /><br /><pre class="brush: csharp">private OrganizationDetail CurrentOrganizationDetail { get; set; }<br />private IDiscoveryService DiscoveryService { get; set; }<br />private OrganizationServiceProxy OrgService { get; set; }<br />private ClientCredentials _ClientCreds { get; set; }<br />private ClientCredentials _DeviceCreds { get; set; }<br />private bool IsLiveID { get; set; }</pre><br /><br /><p>Now, let's add to frmMain class a helper method to builds the full Uri of the discovery service. </p><br /><br /><pre class="brush: csharp">        public Uri GetDiscoveryServiceUri(string serverName)<br />        {<br />            string discoSuffix = @&quot;/XRMServices/2011/Discovery.svc&quot;;<br /><br />            return new Uri(string.Format(&quot;{0}{1}&quot;, serverName, discoSuffix));<br />        }</pre><br /><br /><p>Next, In the event handler for the Discover button, add the following code to use the <strong>ServiceConfigurationFactory</strong> helper class to get an instance of the Discovery service configuration. This returned as an <strong>IServiceConfiguration&lt;IDiscoveryService&gt;</strong> type that hides and simplifies some of the lower level WCF configuration.</p><br /><br /><pre class="brush: csharp">var discoUri = GetDiscoveryServiceUri(ServerURL.Text);<br />IServiceConfiguration<idiscoveryservice> dinfo =               	ServiceConfigurationFactory.CreateConfiguration<idiscoveryservice>(discoUri);</pre><br /><br /><p>Different credentials are needed for CRM online vs. on premises. To differentiate between them we will add the following <strong>GetServerType</strong> helper method. </p><br /><br /><pre class="brush: csharp">public AuthenticationProviderType GetServerType(Uri uri)<br />{<br />   return ServiceConfigurationFactory.CreateConfiguration<idiscoveryservice>(uri).AuthenticationType;<br />}</pre><br /><br /><p>Now, we will return to the Discover button handler. The follwoing code will create a DiscoveryServiceProxy instance based on the server type we connecting to (on-line or on-premises). Note that DeviceIdManager class have been used only in the on-line scenario. Then we use this instance (DiscoveryServiceProxy) to connect to the server, authenticate, and execute our RetrieveOrganizationsRequest to get RetrieveOrganizationResponse. This response has a property OrganizationDetails that is an array of OrganizationDetail objects which we will use to fill the oragnizations combo box. Add the following code to the couple of lines that you are added to btnDiscover_click handler. </p><br /><br /><pre class="brush: csharp">_ClientCreds = new ClientCredentials();<br />DiscoveryServiceProxy dsp;<br /><br />if (GetServerType(discoUri) == AuthenticationProviderType.LiveId)<br />{<br />    _ClientCreds.UserName.UserName = username.Text;<br />    _ClientCreds.UserName.Password = password.Text;<br /><br />    _DeviceCreds = DeviceIdManager.LoadOrRegisterDevice();<br /><br />    dsp = new DiscoveryServiceProxy(discoUri, null, _ClientCreds, _DeviceCreds);<br />    IsLiveID = true;<br />}<br />else<br />{<br />    _ClientCreds.Windows.ClientCredential.UserName = username.Text;<br />    _ClientCreds.Windows.ClientCredential.Password = password.Text;<br />    _ClientCreds.Windows.ClientCredential.Domain = domain.Text;<br /><br />    dsp = new DiscoveryServiceProxy(dinfo, _ClientCreds);<br />    IsLiveID = false;<br />}<br /><br />dsp.Authenticate();<br />var orgRequest = new RetrieveOrganizationsRequest();<br />var orgResponse = dsp.Execute(orgRequest) as RetrieveOrganizationsResponse;<br />comboOrgs.ItemsSource = orgResponse.Details;</pre><br /><br /><p>You can now check your frmMain.cs aginst the below code. If everything is Ok, hit F5, enter the user name/password you used in your 30-days free trial signup (or your active directory credentials, if you test against your on-premises deployment), click Discover button. You will see the organizations combo box filled with the available organizations on this server that you have access to. </p><br /><br /><pre class="brush: csharp">using System;<br />using System.Collections.Generic;<br />using System.ComponentModel;<br />using System.Data;<br />using System.Drawing;<br />using System.Linq;<br />using System.Text;<br />using System.Windows.Forms;<br />using System.Collections;<br /><br />using Microsoft.Xrm.Sdk;<br />using Microsoft.Xrm.Sdk.Client;<br />using Microsoft.Xrm.Sdk.Discovery;<br />using System.ServiceModel.Description;<br />using Microsoft.Crm.Services.Utility;<br /><br />using Microsoft.Xrm.Sdk.Query;<br />using Microsoft.Xrm.Sdk.Messages;<br /><br />namespace xRM_Demo01<br />{<br />    public partial class frmMain : Form<br />    {<br />        private OrganizationDetail CurrentOrganizationDetail { get; set; }<br />        private IDiscoveryService DiscoveryService { get; set; }<br />        private IOrganizationService OrgService { get; set; }<br />        private ClientCredentials _ClientCreds { get; set; }<br />        private ClientCredentials _DeviceCreds { get; set; }<br />        private bool IsLiveID { get; set; }<br />        public frmMain()<br />        {<br />            InitializeComponent();<br />        }<br /><br />        private void btnDiscover_Click(object sender, EventArgs e)<br />        {<br />            var discoUri = GetDiscoveryServiceUri(txtServer.Text);<br /><br />            IServiceConfiguration<idiscoveryservice> dinfo =<br />                ServiceConfigurationFactory.CreateConfiguration<idiscoveryservice>(discoUri);<br />            _ClientCreds = new ClientCredentials();<br />            DiscoveryServiceProxy dsp;<br /><br />            if (GetServerType(discoUri) == AuthenticationProviderType.LiveId)<br />            {<br />                _ClientCreds.UserName.UserName = txtUserName.Text;<br />                _ClientCreds.UserName.Password = txtPassword.Text;<br /><br />                _DeviceCreds = DeviceIdManager.LoadOrRegisterDevice();<br /><br />                dsp = new DiscoveryServiceProxy(discoUri, null, _ClientCreds, _DeviceCreds);<br />                IsLiveID = true;<br />            }<br />            else<br />            {<br />                MessageBox.Show(&quot;This is not a valid Microsoft Dynamics CRM online URL&quot;);<br />                return;<br />            }<br /><br />            dsp.Authenticate();<br />            var orgRequest = new RetrieveOrganizationsRequest();<br />            var orgResponse = dsp.Execute(orgRequest) as RetrieveOrganizationsResponse;<br />            comboOrgs.DataSource = orgResponse.Details;<br />            comboOrgs.DisplayMember = &quot;FriendlyName&quot;;<br />            comboOrgs.ValueMember = &quot;UrlName&quot;;<br />        }<br />        public Uri GetDiscoveryServiceUri(string serverName)<br />        {<br />            string discoSuffix = @&quot;/XRMServices/2011/Discovery.svc&quot;;<br /><br />            return new Uri(string.Format(&quot;{0}{1}&quot;, serverName, discoSuffix));<br />        }<br />        public AuthenticationProviderType GetServerType(Uri uri)<br />        {<br />            return ServiceConfigurationFactory.CreateConfiguration<idiscoveryservice>(uri).AuthenticationType;<br />        }</pre><br /><br /><p><strong>Step 3: Using the Organization Service</strong></p><br /><br /><p>The organization service is the endpoint that you will use to interact with an individual organization's data and metadata services. It accessed using the methods on the IOrganizationService interface. The <strong>OrganizationServiceProxy</strong> helper class is used to make it easier to get instance of IOrganizationService without dealing with the WCF low-level details. Double click on the Connect button to add an event handler for it and add the following code. </p><br /><br /><pre class="brush: csharp">            if (comboOrgs.SelectedItem == null)<br />            {<br />                MessageBox.Show(&quot;You must select an organization before connecting&quot;);<br />                return;<br />            }<br />            this.CurrentOrganizationDetail = comboOrgs.SelectedItem as OrganizationDetail;<br />            Uri orgServiceUri = new Uri(CurrentOrganizationDetail.Endpoints[EndpointType.OrganizationService]);<br />            if (IsLiveID)<br />            {<br />                OrgService = new OrganizationServiceProxy(orgServiceUri, null, _ClientCreds, _DeviceCreds);<br />            }<br />            else<br />            {<br />                IServiceConfiguration<iorganizationservice> orgConfigInfo =<br />                    ServiceConfigurationFactory.CreateConfiguration<iorganizationservice>(orgServiceUri);<br />                OrgService = new OrganizationServiceProxy(orgConfigInfo, _ClientCreds);<br />            }</pre><br /><br /><p>The added code checks that you selected an organization, get the select organization as an OrganizationDetail object, use the <strong>EndPoints</strong> of this object to get the Uri of the Organization Service. Then use this information and the client credentials and the device credentials to create an object of <strong>OrganizationServiceProxy</strong>. </p><br /><br /><p>Now we are ready to start interacting with the organization service through this proxy (which will be the next step). If you want to ensure that you did everything right, you can try send a simple request to the organization service and see the result. To do so, we can send the WhoAmI message to the service and receive the response (the ID of the logged in used). Add a using statement for <em>Microsoft.Crm.Sdk.Messages</em>. Add the following code to the end of btnConnect_click to test your connectivity. </p><br /><br /><pre class="brush: csharp">WhoAmIRequest req = new WhoAmIRequest();<br />var response = OrgService.Execute(req) as WhoAmIResponse;<br />MessageBox.Show(&quot;You are connected as userid &quot; + response.UserId.ToString());</pre><br /><br /><p>Run, put your credentials an server, click Discover, choose your organization from the combo box and click connect. You will get something like the below image. </p><br /><br /><p><a href="http://lh3.ggpht.com/-vvvHVO31EL0/T1f60IsjGeI/AAAAAAAAALw/YEv0COHR_pI/s1600-h/msg4.jpg"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="msg" border="0" alt="msg" src="http://lh6.ggpht.com/-z4hMlPf3MXM/T1f60uqQo2I/AAAAAAAAAL4/4qiLl21lqkQ/msg_thumb2.jpg?imgmax=800" width="415" height="154" /></a> </p><br /><br /><p><strong>Step 4: Working with the CRM data</strong></p><br /><br /><p><font color="#0000ff"><em>Early versus Late-Bounding </em></font>In Microsoft Dynamics CRM 2011, you can choose from several programming styles to find the model that best fits your situation. </p><br /><br /><blockquote><br />  <p>In <u>Early-Bound</u> style, you create a class for each business entity in your CRM deployment. You will use these classes to access business data in your CRM deployment. There is a code generation tool included in the %CRMSDK%\bin called crmsvcutil.exe that will generate early-bound entity classes for you. It works with on-premises and online deployments. Every time you make customizations to your entities, you have to run this tool to regenerate these classes again. The advantages of using early-bound entity classes is that all type references are checked at compile time. You will also enjoy the intellisense support.</p><br /><br />  <p>In <u>Late-Bound</u> style, you can work with the data in CRM without having classes representing each data entity in the organization. Most Probably, you will use this style when working with entities (or customizations) that you can’t anticipate at the development time.</p><br /></blockquote><br /><br /><p>In this step we will work with the CRM data using late-bound style to retrieve all accounts data in our CRM, update it, save it, and add new records also. </p><br /><br /><p><strong>Method</strong> : <strong>RetrieveMultiple</strong></p><br /><br /><p>To retrieve multiple records from Dynamics CRM, we use the <strong>RetrieveMultiple</strong> of the organization service and pass a <strong>QueryExpression</strong> object to it. QueryExpression holds all the information required to get the desired data from Dynamics CRM. To construct the Query expression you need: </p><br /><br /><ul><br />  <li><strong>ColumnSet</strong> object to specify the columns we need to retrieve. </li><br /><br />  <li><strong>ConditionExpression</strong> object to hold any conditions we will use to filter the returned rows. </li><br /><br />  <li><strong>FilterExpression</strong> object to hold all the ConditionExpression objects we use in our query. This enables us to make complex queries. </li><br /><br />  <li><strong>EntityName</strong> a string property used to specify the entity the query runs against. </li><br /><br />  <li>You can also order the returned data through method <strong>AddOrder(“columnName”, OrderType). </strong>OrderType is an enumeration have the values Ascending and Descending. </li><br /></ul><br /><br /><p>For Simplicity we will retrieve columns name and accountid of all account type records in CRM. Because we using late-bound style, we get the results into EntityCollection collection. We enumerate through the returned collection, and put the entities into a list of custom objects of type Item. Then we bind our accounts combobox to this list.</p><br /><br /><pre class="brush: csharp">            ColumnSet cs = new ColumnSet();<br />            cs.AddColumns(&quot;name&quot;, &quot;accountid&quot;);<br /><br />            QueryExpression qe = new QueryExpression();<br />            qe.ColumnSet = cs;<br />            qe.EntityName = &quot;account&quot;;<br /><br />            EntityCollection accountList = OrgService.RetrieveMultiple(qe);<br />            List<item> accounts = new List<item>();<br />            comboAccounts.ValueMember = &quot;Value&quot;;<br />            comboAccounts.DisplayMember = &quot;Name&quot;;<br />            for (int i = 0; i &lt; accountList.Entities.Count; i++ )<br />            {<br />                accounts.Add(new Item(accountList[i].Attributes[&quot;name&quot;].ToString(),<br />                    accountList[i].Attributes[&quot;accountid&quot;].ToString()));<br />            }<br />            comboAccounts.DataSource = accounts;<br />}</pre><br /><br /><p>Also add the following class into your solution namespace, which holds the acounts name and accountid to bind it to the combobox. </p><br /><br /><pre class="brush: csharp">    class Item<br />    {<br />        private string _name;<br />        private string _value;<br />        public string Name<br />        {<br />            get { return _name; }<br />            set { _name = value; }<br />        }<br />        public string Value<br />        {<br />            get { return _value; }<br />            set { _value = value; }<br />        }<br />        public Item(string p_name, string p_value)<br />        {<br />            Name = p_name; <br />            Value = p_value;<br />        }<br />    }</pre><br /><br /><p>Now you can run the application, connect to your organization, and check that the combobox is filled of your accounts data. </p><br /><br /><p><strong>Method :</strong> <strong>Retrieve</strong></p><br /><br /><p>Now we will use the accountid of the selected account in the combobox to get the rest of the account data. In this case we will use the <strong>Retrieve</strong> method of the organization service. This method retrieves just one record of the type specified in the first argument, designated by the key passed in the second argument. Double click on the accounts combobox to add an event handler for the SelectedIndexChanged event. Add the following code to this event handler to fill the form with the account data. </p><br /><br /><pre class="brush: csharp">            ColumnSet cs2 = new ColumnSet(new string[] {&quot;address1_city&quot;,&quot;address1_line1&quot;,&quot;address1_stateorprovince&quot;,<br />                &quot;name&quot;,&quot;industrycode&quot;});<br />            try<br />            {<br />                var account = OrgService.Retrieve(&quot;account&quot;, new Guid(comboAccounts.SelectedValue.ToString()), cs2);<br />                txtName.Text = account.Attributes[&quot;name&quot;].ToString();<br />                txtCity.Text = account.Attributes[&quot;address1_city&quot;].ToString();<br />                txtAddress.Text = account.Attributes[&quot;address1_line1&quot;].ToString();<br />                txtState.Text = account.Attributes[&quot;address1_stateorprovince&quot;].ToString();<br />            }<br />            catch (Exception ex)<br />            {<br />                MessageBox.Show(&quot;An error happened: &quot; + ex.Message);<br />            }</pre><br /><br /><p><strong>Method : Update</strong></p><br /><br /><p>Now we can go farther and modify the current displayed account data and try to save it. To save any entity data into CRM, create an Entity object and pass the entity type into the constructor (it will be &quot;account&quot; in our case). Then set the attribute values you want and pass the updated entity to the organization service <strong>Update</strong> method. Add the following code the save button click event handler to realize the update operation.</p><br /><br /><pre class="brush: csharp"> <br />try<br />            {<br />                Entity account = new Entity(&quot;account&quot;);<br />                account.Attributes[&quot;accountid&quot;] = new Guid(comboAccounts.SelectedValue.ToString());<br />                account.Attributes[&quot;name&quot;] = txtName.Text;<br />                account.Attributes[&quot;address1_line1&quot;] = txtAddress.Text;<br />                account.Attributes[&quot;address1_city&quot;] = txtCity.Text;<br />                account.Attributes[&quot;address1_stateorprovince&quot;] = txtState.Text;<br />                OrgService.Update(account);<br />                MessageBox.Show(&quot;Account updated successfully&quot;);<br />                // TODO: reload the accounts combobox.<br />            }<br />            catch (Exception ex)<br />            {<br />                MessageBox.Show(&quot;An error occurred : &quot; + ex.Message);<br />            }         </pre><br /><br /><p><strong>Method : Delete</strong></p><br /><br /><p>To delete a record you use the <strong>Delete</strong> method of the organization service, pass the entity type name and its key like the following.</p><br /><br /><pre class="brush: csharp">try<br />            {<br />                OrgService.Delete(&quot;account&quot;, new Guid(comboAccounts.SelectedValue.ToString()));<br />                MessageBox.Show(&quot;Account deleted successfully&quot;);<br />                // TODO: reload the accounts combobox<br />            }<br />            catch (Exception ex)<br />            {<br />                MessageBox.Show(&quot;An error occurred : &quot; + ex.Message);<br />            }</pre><br /><br /><p>Now let's add code to clear the form in the clear button click event handler. </p><br /><br /><pre class="brush: csharp">            txtName.Text = &quot;&quot;;<br />            txtCity.Text = &quot;&quot;;<br />            txtAddress.Text = &quot;&quot;;<br />            txtState.Text = &quot;&quot;;</pre><br /><br /><p><strong>Method : Create</strong></p><br /><br /><p>To insert a new record to CRM, we create an Entity object passing the entity name to its constructor, set its attributes, and pass it to the organization service <strong>Create</strong> method. Add the following code to the save new button click event handler. </p><br /><br /><pre class="brush: csharp">try<br />            {<br />                Entity account = new Entity(&quot;account&quot;);<br />                account.Attributes[&quot;name&quot;] = txtName.Text;<br />                account.Attributes[&quot;address1_line1&quot;] = txtAddress.Text;<br />                account.Attributes[&quot;address1_city&quot;] = txtCity.Text;<br />                account.Attributes[&quot;address1_stateorprovince&quot;] = txtState.Text;<br />                OrgService.Create(account);<br />                MessageBox.Show(&quot;Account created successfully&quot;);<br />            }<br />            catch (Exception ex)<br />            {<br />                MessageBox.Show(&quot;An error occurred : &quot; + ex.Message);<br />            }</pre><br /><br /><p>No we have examined almost all basic data operations on the CRM data using late-bounding style: RetrieveMultiple, Retrieve, Update, Delete, and Create new record.</p><br /><br /><p><strong>Generating Client Types for Early Binding</strong></p><br /><br /><p>Now we will use a different style than the one we used above. We will use the SDK tool <strong>crmsvcutil.exe</strong> to generate the typed classes for our CRM entities bsed on the metadata service of our CRM organization. These generated typed classes will inherit from the Entity class we worked with earlier in this post. Now follow the following steps to generate your typed classes:</p><br /><br /><ol><br />  <li>Open the project included in the SDK at %SDK%\tools\deviceregistration folder and build it. </li><br /><br />  <li>Open the command prompt cmd.exe and change directories to %SDK%\tools\deviceregistration\bin\Debug and run the command <strong>DeviceRegistration.exe /operation:Register</strong> This will generate a Device ID and Device Password for you (similar to the ones created by deviceidmanager.cs class). </li><br /><br />  <li>Copy the Deviceid and Device Password to a notepad. (if you are not familiar with cmd, right click the inside the window and click highlight, then highlight the desired text, then right click the cmd window title bar and click Edit&gt;&gt; copy.) </li><br /><br />  <li>In the command window, change the directories to %SDK%\bin and create a command like the following: </li><br /></ol><br /><br /><p>crmsvcutil.exe /url:<font color="#ff0000">&lt;CRM Online Organization service URL&gt;</font> /out:<font color="#ff0000">&lt;Output file name&gt;</font> /servicecontextName:<font color="#ff0000">&lt;</font><font color="#ff0000">Organization name&gt;</font> /username:<font color="#ff0000">&lt;LiveID&gt;</font> /password:<font color="#ff0000">&lt;LiveIDPassword&gt;</font> <br /><br />  <br />/deviceid:<font color="#ff0000">&lt;Deviceid&gt;</font> /devicepassword:<font color="#ff0000">&lt;DevicePassword&gt;</font> /namespace:<font color="#ff0000">&lt;Namespace&gt;</font></p><br /><br /><p><font color="#ff0000">&lt;CRM Online Organization service URL&gt; </font><font color="#000000">will be like https://xrmdemo5.api.crm.dynamics.com/XRMServices/2011/Organization.svc? . You can find your URL by going to Settings &gt;&gt; Customizations &gt;&gt; Developer Resources, your URL will be there.</font></p><br /><br /><p><font color="#ff0000">&lt;Output file name&gt; </font><font color="#000000">is the file name of the generated code (like GeneratedEntities.cs)</font></p><br /><br /><p><font color="#ff0000">&lt;</font><font color="#ff0000">Organization name&gt; </font><font color="#000000">is your organization name.</font></p><br /><br /><p><font color="#000000"><font color="#ff0000">&lt;LiveID&gt;</font>, <font color="#ff0000">&lt;LiveIDPassword&gt;</font> are your live credentials used for this organization.</font></p><br /><br /><p><font color="#000000"><font color="#ff0000">&lt;Deviceid&gt;</font>, <font color="#ff0000">&lt;DevicePassword&gt;</font> are provided from step 3.</font></p><br /><br /><p><font color="#000000"><font color="#ff0000">&lt;Namespace&gt;</font> is the name space of the generated classes (may be YourCompanyname.YourOrganizationName)</font></p><br /><br /><p>the complete command may look like </p><br /><br /><p><font style="background-color: #9c85c0" color="#ffffff">crmsvcutil.exe /url:</font><a href="https://xrmdemo5.api.crm.dynamics.com/XRMServices/2011/Organization.svc"><font style="background-color: #9c85c0" color="#ffffff">https://xrmdemo5.api.crm.dynamics.com/XRMServices/2011/Organization.svc</font></a><font style="background-color: #9c85c0" color="#ffffff"> /out:GeneratedEntities.cs /servicecontextName:xrmdemo5 /username:ebeid_soliman@hotmail.com /password:mypassword <br />    <br />/deviceid:11denl276oo3fgxbakccnnq2x4 /devicepassword:bH.iaG?c3rRi-`L,nKC0S4^^ /namespace:xRMDemo.Entities</font></p><br /><br /><p>Now we created our early bound entity classes. Let’s modify our application to use the early-bound entity classes that we generated.</p><br /><br /><p><strong>Step 1: Add the generated types to the project</strong></p><br /><br /><p>Right click on the project in the solution explorer and click Add existing, browse to %CRMSDK%\bin and add your generated file (its GeneratedEntities.cs in my above command). </p><br /><br /><p><strong>Step 2: Enable proxy types</strong></p><br /><br /><p>In order to use the generated types when dealing with the organization service, you have to add the <em>ProxyTypesBehavior</em> to the endpoint <em>Behaviors</em> collection. This instructs the OrganizationServiceProxy to look in the assembly for classes with certain attributes to use. The generated classes are already attributed with these attributes. Simply, this makes all interactions with the organization service to be done using the generated typed classes for each entity instead of the generic Entity class we used earlier. </p><br /><br /><p>Open the frmMain.cs, locate btnConnect_Click event handler and add the following line of code after the last section line that creates the new instance of our OrganizationServiceProxy. </p><br /><br /><pre class="brush: csharp">OrgService.ServiceConfiguration.CurrentServiceEndpoint.Behaviors.Add(new ProxyTypesBehavior());</pre><br /><br /><p><strong>Method</strong> : <strong>RetrieveMultiple</strong></p><br /><br /><p>It’s the same before. Now, let's modify the accounts combobox filling section to use the generated Account class instead of the Item class (you can get ride of it) that we created earlier. Modify the last section in btnConnect_Click event handler to look like the following. </p><br /><br /><pre class="brush: csharp">List<account> accounts = new List<account>();<br />            comboAccounts.ValueMember = &quot;accountid&quot;;<br />            comboAccounts.DisplayMember = &quot;name&quot;;<br />            for (int i = 0; i &lt; accountList.Entities.Count; i++)<br />            {<br />                accounts.Add((Account)accountList[i]);<br />            }<br />            comboAccounts.DataSource = accounts;</pre><br /><br /><p><strong>Method : Retrieve</strong></p><br /><br /><p>It almost the same, except we will use Account class and its properties instead of the Entity class and its attributes. Modify the comboAccounts_SelectedIndexChanged event handler to look like: </p><br /><br /><pre class="brush: csharp">ColumnSet cs2 = new ColumnSet(new string[] {&quot;address1_city&quot;,&quot;address1_line1&quot;,&quot;address1_stateorprovince&quot;,<br />                &quot;name&quot;,&quot;industrycode&quot;});<br />            try<br />            {<br />                Account account = (Account)OrgService.Retrieve(&quot;account&quot;, new Guid(comboAccounts.SelectedValue.ToString()), cs2);<br />                txtName.Text = account.Name;<br />                txtCity.Text = account.Address1_City;<br />                txtAddress.Text = account.Address1_Line1;<br />                txtState.Text = account.Address1_StateOrProvince;<br />            }<br />            catch (Exception ex)<br />            {<br />                MessageBox.Show(&quot;An error happened: &quot; + ex.Message);<br />            }</pre><br /><br /><p>Delete method is solely done by the organization service, so it didn't change due the style we use. </p><br /><br /><p><strong>Method : Create</strong> </p><br /><br /><p>It almost the same, except we will use Account class and its properties instead of the Entity class and its attributes. Modify the btnSaveNew_Click event handler to look like: </p><br /><br /><pre class="brush: csharp">try<br />            {<br />                Account account = new Account();<br />                account.Name = txtName.Text;<br />                account.Address1_Line1 = txtAddress.Text;<br />                account.Address1_City = txtCity.Text;<br />                account.Address1_StateOrProvince = txtState.Text;<br />                OrgService.Create(account);<br />                MessageBox.Show(&quot;Account created successfully&quot;);<br />            }<br />            catch (Exception ex)<br />            {<br />                MessageBox.Show(&quot;An error occurred : &quot; + ex.Message);<br />            }</pre><br /><br /><p>This post is one of multiple posts to come under the same topic, Microsoft Dynamics CRM 2011 for Developers. Basicly we will deal with Dynamics CRM from the developer point of view. In this post we have tried to cover the basics of accessing Microsoft Dynamics CRM data using WCF. We tried the basic data operations: retrieve multiple records, retrieve one record, update, delete, and insert. We tried to cover both early-bounding and late-bounding approaches in our implementations.</p>  
---
layout: post
title: Microsoft Dynamics CRM 2011 for Developers | Plug-ins
date: '2012-03-23T15:49:00.001-05:00'
author: Ebeid Soliman ElSayed
tags:
- Dynamics CRM Plug-in Registration Tool
- Microsoft Dynamics CRM 2011
- Plug-ins
- WCF
modified_time: '2012-03-23T15:49:42.537-05:00'
thumbnail: http://lh5.ggpht.com/-6-oxUTh5oQ8/T2zht7bBxhI/AAAAAAAAAcs/zFkQoT-Nqys/s72-c/xRM_Demo03%252520-%252520Microsoft%252520Visual%252520Studio%252520%252528Administrator%252529_2012-03-19_12-33-32_thumb.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-59384554657271185.post-523580624632940019
blogger_orig_url: http://ebeid-soliman.blogspot.com/2012/03/microsoft-dynamics-crm-2011-for_23.html
---

<h4><strong>Contents</strong></h4>  <ol>   <li>Introduction </li>    <li>Common Uses of Plug-ins </li>    <li>Plug-ins Basics      <ol>       <li>Event Framework </li>        <li>Event Execution Pipeline </li>        <li>Pipeline Stages </li>        <li>Message Processing </li>        <li>Inclusion in Database Transactions&#160; </li>        <li>Plug-in Isolation </li>        <li>Trusts </li>     </ol>   </li>    <li>Develop Plug-ins</li>    <li>Register Plug-ins </li> </ol>  <p><strong>Introduction</strong></p>  <p>A plug-in is .Net assembly that can be used to intercept events generated from the CRM system. Plug-ins subscribe to a set of events and run when the events occur regardless of how the event raised (or the method that is used to perform the activity that raised the event). </p>  <p>Any number of plug-ins can be associated with a given entity and event. When multiple plug-ins are registered for the same event on the same entity, they are called in a sequence based on the order specified on the step registration. This value is specified as the Rank and it is supplied when the plug-in is registered. This allows developer control over the sequence. </p>  <p><strong>Common Uses of Plug-ins</strong></p>  <p>Plug-ins have many uses like:</p>  <ul>   <li>Performing complex business logic data validation </li>    <li>Performing complex update routines on CRM entities and/or attributes when it is impractical to use JavaScript. </li>    <li>Grabbing data from another system and updating CRM when an entity instance is being created or updated. </li>    <li>Updating another system programmatically from CRM </li> </ul>  <p><strong>Plug-ins Basics</strong></p>  <p><strong>Event Framework </strong>Event framework is the term that is used to describe the technology and mechanisms available in Microsoft Dynamics CRM to enable you to extend or customize functionality with custom code. Your custom code will run on top of Dynamics CRM either synchronously as part of the main Microsoft Dynamics CRM execution path, or asynchronously from a managed queue.</p>  <p><strong>Event Execution Pipeline </strong>Event framework executes plug-ins based on a message pipeline execution model. A user action in the Microsoft Dynamics CRM Web application or an SDK method call by a plug-in or other application results in a message being sent to the organization Web service. The message contains business entity information and core operation information. The message is passed through the event execution pipeline where it can be read or modified by the platform core operation and any registered plug-ins.</p>  <p>The event execution pipeline processes events either synchronously or asynchronously. The platform core operation and any plug-ins registered for synchronous execution are executed immediately. Synchronous plug-ins that are registered for the event are executed in a well-defined order. Plug-ins registered for asynchronous execution are queued by the Asynchronous Queue Agent and executed at a later time by the asynchronous service.</p>  <p><strong>Pipeline Stages </strong>The event execution pipeline is divided into multiple stages, four of them are available to register custom developed plug-ins. Multiple plug-ins that are registered in each stage can be further be ordered (ranked) within that stage during plug-in registration.</p>  <table border="1" cellspacing="0" cellpadding="2" width="556"><tbody>     <tr>       <td valign="top" width="68">         <p align="center"><strong><font color="#0000ff">Event</font></strong></p>       </td>        <td valign="top" width="101">         <p align="center"><strong><font color="#0000ff">Stage name</font></strong></p>       </td>        <td valign="top" width="59">         <p align="center"><strong><font color="#0000ff">Stage number</font></strong></p>       </td>        <td valign="top" width="326">         <p align="center"><strong><font color="#0000ff">Description</font></strong></p>       </td>     </tr>      <tr>       <td valign="top" width="68">Pre-Event</td>        <td valign="top" width="101">Pre-validation</td>        <td valign="top" width="59">10</td>        <td valign="top" width="326">         <ul>           <li>             <div align="left">For plug-ins that execute before the main system operation.</div>           </li>            <li>             <div align="left">Plug-ins may execute outside the database transaction.</div>           </li>            <li>             <div align="left">For plug-ins run prior to making security checks on the calling user.&#160;&#160; <br /></div>           </li>         </ul>       </td>     </tr>      <tr>       <td valign="top" width="68">Pre-Event</td>        <td valign="top" width="101">Pre-operation</td>        <td valign="top" width="59">20</td>        <td valign="top" width="326">         <ul>           <li>             <div align="left">For plug-ins that execute before the main system operation.</div>           </li>            <li>             <div align="left">Plug-ins execute within the database transaction. </div>           </li>         </ul>       </td>     </tr>      <tr>       <td valign="top" width="68">Platform Core Operation</td>        <td valign="top" width="101">MainOperation</td>        <td valign="top" width="59">30</td>        <td valign="top" width="326">         <ul>           <li>Dedicated to main system operations. </li>            <li>For internal use only, no custom plug-ins can register in this stage. </li>         </ul>       </td>     </tr>      <tr>       <td valign="top" width="68">Post-Event</td>        <td valign="top" width="101">Post-operation</td>        <td valign="top" width="59">40</td>        <td valign="top" width="326">         <ul>           <li>For plug-ins that execute after the main operation. </li>            <li>Plug-ins execute within the database transaction. </li>         </ul>       </td>     </tr>      <tr>       <td valign="top" width="68">Post-Event</td>        <td valign="top" width="101">Post-operation          <br />(Deprecated)</td>        <td valign="top" width="59">50</td>        <td valign="top" width="326">         <ul>           <li>For Dynamics CRM 4.0 based plug-ins ONLY. </li>         </ul>       </td>     </tr>   </tbody></table>  <p><strong>Message Processing</strong> as we saw in a previous <a href="http://ebeid-soliman.blogspot.com/2012/03/accessing-microsoft-dynamics-crm-2011.html" target="_blank">post</a>, any web service method call is done through <u>OrganizationRequest</u> message. This call raises an event. Information in this message is passed to first plug-in registered for that event. Plug-in receives the message information in the form of context that is passed to its <u>Execute</u> method, where it can be read or modify its contents before passing it to the next registered plug-in for that event and so on. The message then passed to the platform core operation. After the core platform operation has completed, the message is then known as the <u>OrganizationResponse</u>. This response is passed to the registered post-event plug-ins which may modify it before a copy of the response is passed to any registered asynchronous plug-ins. Finally, the response is returned to the application or workflow that initiated the original Web service method call.</p>  <p>Because a single Microsoft Dynamics CRM server can host more than one organization, the execution pipeline is organization specific. Plug-ins registered with the pipeline can only process business data for a single organization.</p>  <p><strong>Inclusion in Database Transactions</strong> Plug-ins can execute or not execute within the database transaction of the Dynamics CRM platform. Within the plug-in, you can detect that through the <u>IsInTransaction</u> property in <u>IPluginExecutionContext</u> that is passed to the plug-in. Any registered plug-in that executes during the database transaction and that passes an exception back to the platform cancels the core operation. This results in a rollback of the core operation. In addition, any pre-event or post event registered plug-ins that have not yet executed and any workflow that is triggered by the same event that the plug-in was registered for will not execute.</p>  <p><strong>Plug-in Isolation</strong> The execution of plug-ins can be in an isolated environment, known as a <em>sandbox</em>, where a plug-in can access and use the organization Web service only. Plug-ins can’t access system resources but can access to external endpoints (only through HTTP and HTTPS). CRM platform collects run-time statistics and monitors plug-ins that execute in the sandbox, if it exceeded certain thresholds or became unresponsive, it kills the sandbox worker process (this makes all currently executing plug-ins in the current organization fail).</p>  <p><strong>Trusts</strong></p>  <ul>   <li><u>Full trust</u> Plug-ins run outside the sandbox, available in on-premises and internet facing deployments. </li>    <li><u>Partial trust</u> Plug-ins run inside the sandbox, available in all deployments. </li> </ul>  <p><strong>Develop Plug-ins</strong></p>  <p>Simply plug-ins are classes that implement the IPlugin interface. You can write a plug-in in any .NET Framework 4 CLR-compliant language. </p>  <p>Now let’s consider a simple case that plug-ins may be its appropriate solution. Let say that your company wants leads to be numbered automatically when they are created. In order to achieve our goal, we will add a custom field to the Lead entity and add it to the form. We will disable this field on the form. We will create a plug-in and register it for the Pre-event for the Create message on the Lead entity. When a lead is created, it will look for the next available number in the system and assign it to the newly created Lead.</p>  <p><strong>Step 1: Create Customizations</strong></p>  <p>Now we will quickly customize the Lead entity and form to accommodate our solution. Navigate to <u>Settings</u> &gt; <u>Customizations</u> &gt; <u>Customize the System</u>. In the left navigation pane, expand <u>Entities</u>, expand <u>Lead</u>, select <u>Fields</u>, and click New.&#160;&#160; <br />In the New for Lead form, set the Display Name to Auto Number, the Type to Whole Number, and then click <u>Save and Close</u>. In the left navigation Pane, select <u>Forms</u>. Click the Main Information form &gt; Drag the field, new_autonumber, to the Name section of the <u>General</u> section. Select the field, click <u>Change Properties</u>, mark the <u>Field is read-only</u> check box, and then click <u>OK</u>. Click <u>Save and Close</u>, and then <u>Publish</u>.</p>  <p><strong>Step 2: Create the Plug-in</strong></p>  <p>1- Open Visual Studio and Create a new project of type Class Library.</p>  <p>2- Add references to Microsoft.Xrm.Client.dll, Microsoft.Xrm.Sdk.dll, and Microsoft.crm.sdk.proxy.dll [located at %SDK%\bin folder].</p>  <p>3- Add references to System.Data.Services, System.Data.Services.Client, System.Runtime.Serialization, and System.ServiceModel.</p>  <p>4- Add reference to Microsoft.IdentityModel.dll from &quot;C:\Program Files\Reference Assemblies\Microsoft\Windows Identity Foundation\v3.5\”. Then go to reference properties and set Copy Local to True for the DLL. The DLL will be included in the package. If you don’t have the dll you need to install <a href="http://www.microsoft.com/download/en/details.aspx?id=17331" target="_blank">Windows Identity Foundation</a>.</p>  <p>5- Make your class implement the IPlugin interface, and implement its member method Execute method. This identifies your class as a plugin to the CRM platform when registering your assembly later. Plug-in code will be placed in the <u>Execute</u> method which takes a parameter of type <u>IServiceProvider</u>. This parameter is a container of many objects that will be utilized by our code.</p>  <p>First get the IPluginExecutionContext. This context object gives you access to all the property values associated with the entity and event context where the method is being executed.</p>  <pre class="brush: csharp">IPluginExecutionContext context = (IPluginExecutionContext) serviceProvider.GetService(typeof(IPluginExecutionContext));</pre><br /><br /><p>InputParameters property of the context is a collection of the request parameters associated with the event. We use it to check the entity of which the event is fired. </p><br /><br /><pre class="brush: csharp">if (context.InputParameters.Contains(&quot;Target&quot;) &amp;&amp; context.InputParameters[&quot;Target&quot;] is Entity)<br />            {<br />                Entity entity = (Entity)context.InputParameters[&quot;Target&quot;];<br />                if (entity.LogicalName != &quot;lead&quot;)<br />                    return;</pre><br /><br /><p>Then we get the OrganizationServiceFactory to use it to create an OrganizationService. We also get the TracingService. Then we edited our auto number field with the next maximum number in the organization. GetMaxLeadNumber is a typical method that passes a QueryExpression to the OrganizationService to get the next max lead number. </p><br /><br /><pre class="brush: csharp">IOrganizationServiceFactory orgServiceFactory = (IOrganizationServiceFactory)serviceProvider.GetService(typeof(IOrganizationServiceFactory));<br />                ITracingService tracingService = (ITracingService)serviceProvider.GetService(typeof(ITracingService));<br />                IOrganizationService orgService = orgServiceFactory.CreateOrganizationService(context.UserId);<br /><br />                try<br />                {                                  <br />                    entity.Attributes[&quot;new_autonumber&quot;] = GetMaxLeadNumber(orgService);            <br />                }<br />                catch (Exception ex)<br />                {<br />                    tracingService.Trace(&quot;xRM_Demo03 | {0}&quot;, ex.ToString());<br />                    throw; <br />                }                <br />            }<br />        }</pre><br /><br /><p>Now your class should look like:</p><br /><br /><pre class="brush: csharp">using System;<br />using System.ComponentModel;<br />using System.Diagnostics;<br />using System.Security;<br />using System.ServiceModel.Description;<br />using Microsoft.Xrm.Sdk;<br />using Microsoft.Xrm.Sdk.Client;<br />using Microsoft.Xrm.Sdk.Query;<br />using System.Collections;<br /><br />namespace xRM_Demo03<br />{<br />    public class Plugin:IPlugin <br />    {<br />        public void Execute(IServiceProvider serviceProvider)<br />        {<br />            IPluginExecutionContext context = <br />                (IPluginExecutionContext)serviceProvider.GetService(typeof(IPluginExecutionContext));<br /><br />            if (context.InputParameters.Contains(&quot;Target&quot;) &amp;&amp; context.InputParameters[&quot;Target&quot;] is Entity)<br />            {<br />                Entity entity = (Entity)context.InputParameters[&quot;Target&quot;];<br />                if (entity.LogicalName != &quot;lead&quot;)<br />                    return;<br /><br />                IOrganizationServiceFactory orgServiceFactory = (IOrganizationServiceFactory)serviceProvider.GetService(typeof(IOrganizationServiceFactory));<br />                IOrganizationService orgService = orgServiceFactory.CreateOrganizationService(context.UserId);<br />                ITracingService tracingService = (ITracingService)serviceProvider.GetService(typeof(ITracingService));<br /><br />                try<br />                {                    <br />                    Random rand = new Random();                    <br />                    entity.Attributes[&quot;new_autonumber&quot;] = GetMaxLeadNumber(orgService);            <br />                }<br />                catch (Exception ex)<br />                {<br />                    tracingService.Trace(&quot;xRM_Demo03 | {0}&quot;, ex.ToString());<br />                    throw; <br />                }                <br />            }<br />        }<br /><br />        private int GetMaxLeadNumber(IOrganizationService orgService)<br />        {    <br />            QueryExpression qe = new QueryExpression(&quot;lead&quot;);<br />            qe.ColumnSet.AddColumn(&quot;new_autonumber&quot;);         <br />            qe.AddOrder(&quot;new_autonumber&quot;, OrderType.Descending);<br />            qe.PageInfo.Count = 1;<br />            qe.PageInfo.PageNumber = 1;<br /><br />            Entity entity = (Entity)orgService.RetrieveMultiple(qe)[0];<br />            if (entity.Attributes[&quot;new_autonumber&quot;].ToString()!= string.Empty)<br />                return int.Parse(entity.Attributes[&quot;new_autonumber&quot;].ToString()) + 1;<br />            else<br />                return 1;<br />        }<br />    }<br />}</pre><br /><br /><p>Now the last step is to sign your assembly. Double click Properties under your plugin project.</p><br /><br /><p><a href="http://lh3.ggpht.com/-IfxDR5X1NDo/T2zhtdfVywI/AAAAAAAAAck/M_NB9igKWZU/s1600-h/xRM_Demo03%252520-%252520Microsoft%252520Visual%252520Studio%252520%252528Administrator%252529_2012-03-19_12-33-32%25255B2%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="xRM_Demo03 - Microsoft Visual Studio (Administrator)_2012-03-19_12-33-32" border="0" alt="xRM_Demo03 - Microsoft Visual Studio (Administrator)_2012-03-19_12-33-32" src="http://lh5.ggpht.com/-6-oxUTh5oQ8/T2zht7bBxhI/AAAAAAAAAcs/zFkQoT-Nqys/xRM_Demo03%252520-%252520Microsoft%252520Visual%252520Studio%252520%252528Administrator%252529_2012-03-19_12-33-32_thumb.png?imgmax=800" width="240" height="183" /></a></p><br /><br /><p>then click Signing from the left tabs</p><br /><br /><p><a href="http://lh3.ggpht.com/-e5ZX4Tzeb7s/T2zhuUwluEI/AAAAAAAAAc0/srC4wTbiOd8/s1600-h/xRM_Demo03%252520-%252520Microsoft%252520Visual%252520Studio%252520%252528Administrator%252529_2012-03-19_12-34-21%25255B3%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="xRM_Demo03 - Microsoft Visual Studio (Administrator)_2012-03-19_12-34-21" border="0" alt="xRM_Demo03 - Microsoft Visual Studio (Administrator)_2012-03-19_12-34-21" src="http://lh6.ggpht.com/-a2ruRgXRBI8/T2zhv_kywZI/AAAAAAAAAc8/hv5c-r1GKAY/xRM_Demo03%252520-%252520Microsoft%252520Visual%252520Studio%252520%252528Administrator%252529_2012-03-19_12-34-21_thumb%25255B1%25255D.png?imgmax=800" width="467" height="398" /></a></p><br /><br /><p>select Sign the assembly checkbox, choose New from the dropbox or choose an existing key. Build the project. Now we are ready to register our plugin into Dynamics CRM.</p><br /><br /><p><strong>Step 3: Register the Plug-in </strong></p><br /><br /><br /><br /><br /><br /><p>The Dynamics CRM SDK have a tool to register plugins located as a source code at %CRMSDK%\tools\pluginregistration. Open the solution, build it, and run it.</p><br /><br /><p>1- Click the <u>Create New Connection</u> on the toolbar. Enter a name for the connection, organization URL, and the email you used for creating this organization.<a href="http://lh4.ggpht.com/-O-dFTKlbZG4/T2zhwVVSUDI/AAAAAAAAAdE/0R7GPtzg6Vg/s1600-h/Plugin%252520Registration%252520Tool_2012-03-19_12-20-45%25255B3%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Plugin Registration Tool_2012-03-19_12-20-45" border="0" alt="Plugin Registration Tool_2012-03-19_12-20-45" src="http://lh6.ggpht.com/-OYNYNwngpEE/T2zhxBRRhJI/AAAAAAAAAdM/P76G_TQGVxQ/Plugin%252520Registration%252520Tool_2012-03-19_12-20-45_thumb%25255B1%25255D.png?imgmax=800" width="395" height="327" /></a></p><br /><br /><p>Click <u>Connect</u>, it will ask you for the password.</p><br /><br /><p><a href="http://lh4.ggpht.com/-LThsQayYv78/T2zhxSbyKjI/AAAAAAAAAdU/VLvoRl1Aacg/s1600-h/Connect%252520to%252520CRM%252520Web%252520Service_2012-03-19_12-21-24%25255B2%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Connect to CRM Web Service_2012-03-19_12-21-24" border="0" alt="Connect to CRM Web Service_2012-03-19_12-21-24" src="http://lh6.ggpht.com/-UIQ8Gnu0e24/T2zhxzd-ZDI/AAAAAAAAAdc/ypOCI9R7Id4/Connect%252520to%252520CRM%252520Web%252520Service_2012-03-19_12-21-24_thumb.png?imgmax=800" width="244" height="212" /></a></p><br /><br /><p>Enter your password and click Ok to connect to the CRM organization web service.</p><br /><br /><p>After getting connected click <u>Register</u> &gt; <u>Register New Assembly</u> </p><br /><br /><p><a href="http://lh5.ggpht.com/-eSEzdotUCaI/T2zhyBsIBCI/AAAAAAAAAdk/WfTBDO_nugM/s1600-h/Plugin%252520Registration%252520Tool_2012-03-19_12-27-20%25255B2%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Plugin Registration Tool_2012-03-19_12-27-20" border="0" alt="Plugin Registration Tool_2012-03-19_12-27-20" src="http://lh5.ggpht.com/-LUfbZQic9QI/T2zhyntykJI/AAAAAAAAAds/DqA5bbv8py0/Plugin%252520Registration%252520Tool_2012-03-19_12-27-20_thumb.png?imgmax=800" width="244" height="126" /></a></p><br /><br /><p>This will open Register New Plugin dialog.</p><br /><br /><p><a href="http://lh3.ggpht.com/-KLxe9EnZNe4/T2zhy04bgUI/AAAAAAAAAd0/KggJbnZIFpQ/s1600-h/Register%252520New%252520Plugin_2012-03-19_12-27-57%25255B5%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Register New Plugin_2012-03-19_12-27-57" border="0" alt="Register New Plugin_2012-03-19_12-27-57" src="http://lh3.ggpht.com/-eSqBRvBgF44/T2zhzsgsDDI/AAAAAAAAAd8/5G4_OpdjnBI/Register%252520New%252520Plugin_2012-03-19_12-27-57_thumb%25255B3%25255D.png?imgmax=800" width="471" height="517" /></a></p><br /><br /><p>Click the three dots button in the top right of the dialog, browse to your plugin dll. Ensure that your plugin is listed and checked. Also ensure that you selected Sandbox as isolation mode, and to store your assembly in the Database as shown below.</p><br /><br /><p><a href="http://lh6.ggpht.com/-2ZbzQXxWZvk/T2zh0JHlQOI/AAAAAAAAAeE/2NbmCx1L-n0/s1600-h/Register%252520New%252520Plugin_2012-03-19_12-29-50%25255B5%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Register New Plugin_2012-03-19_12-29-50" border="0" alt="Register New Plugin_2012-03-19_12-29-50" src="http://lh4.ggpht.com/-Y12kxSSZiYs/T2zh0jJdA3I/AAAAAAAAAeM/N_DQTD6V_vk/Register%252520New%252520Plugin_2012-03-19_12-29-50_thumb%25255B3%25255D.png?imgmax=800" width="476" height="522" /></a></p><br /><br /><p>Click <u>Register Selected Plugins</u>. You will see in the log the steps done by the tool and when it is done it will show message box showing how many assemblies and plugins have been registered (you could have multiple plugins in one assembly). Click Ok.</p><br /><br /><p><a href="http://lh4.ggpht.com/-dcoQAsZmjYQ/T2zh0_2kEUI/AAAAAAAAAeU/7YMVXjnTKRo/s1600-h/xRM_Demo03%252520-%252520Microsoft%252520Visual%252520Studio%252520%252528Administrator%252529_2012-03-19_12-36-58%25255B4%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="xRM_Demo03 - Microsoft Visual Studio (Administrator)_2012-03-19_12-36-58" border="0" alt="xRM_Demo03 - Microsoft Visual Studio (Administrator)_2012-03-19_12-36-58" src="http://lh6.ggpht.com/-jDQwmD5GvmM/T2zh1uJr6pI/AAAAAAAAAec/PrW1tHbf1-A/xRM_Demo03%252520-%252520Microsoft%252520Visual%252520Studio%252520%252528Administrator%252529_2012-03-19_12-36-58_thumb%25255B2%25255D.png?imgmax=800" width="477" height="518" /></a></p><br /><br /><p>Now select your assembly from the list </p><br /><br /><p><a href="http://lh4.ggpht.com/-MFmwz2UmKzo/T2zh2Wpa7fI/AAAAAAAAAek/Izxl2LmBYp0/s1600-h/Plugin%252520Registration%252520Tool_2012-03-19_12-39-46%25255B4%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Plugin Registration Tool_2012-03-19_12-39-46" border="0" alt="Plugin Registration Tool_2012-03-19_12-39-46" src="http://lh3.ggpht.com/-p55bYm8q1QQ/T2zh35L3kzI/AAAAAAAAAes/SPuCiM7BFRc/Plugin%252520Registration%252520Tool_2012-03-19_12-39-46_thumb%25255B2%25255D.png?imgmax=800" width="479" height="401" /></a></p><br /><br /><p>and click Register &gt; <u>Register New Step</u>. This will open Register New Step dialog. This dialog used to define mainly the message, the entity, and the stage that your plugin will execute within. We will register for Message <em>Create</em>, Entity <em>lead</em>, <em>Pre-operaton</em> stage. Click <u>Register New Step</u>.</p><br /><br /><p><a href="http://lh6.ggpht.com/-qNi8MGQGk1E/T2zh4YYEhjI/AAAAAAAAAe0/HuPsTNBJKZY/s1600-h/Register%252520New%252520Step_2012-03-19_12-42-08%25255B3%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Register New Step_2012-03-19_12-42-08" border="0" alt="Register New Step_2012-03-19_12-42-08" src="http://lh4.ggpht.com/-W5TGJREt2hg/T2zh4mRpw9I/AAAAAAAAAe8/awk2cOcLa6E/Register%252520New%252520Step_2012-03-19_12-42-08_thumb%25255B1%25255D.png?imgmax=800" width="453" height="243" /></a></p><br /><br /><p>You will see child step added under your assembly.</p><br /><br /><p><a href="http://lh5.ggpht.com/-mA7XuBdhmDI/T2zh5C4sjJI/AAAAAAAAAfE/LLKPxkgJqVg/s1600-h/Plugin%252520Registration%252520Tool_2012-03-19_12-43-20%25255B5%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Plugin Registration Tool_2012-03-19_12-43-20" border="0" alt="Plugin Registration Tool_2012-03-19_12-43-20" src="http://lh4.ggpht.com/-XLKKj5bArqo/T2zh5Un6LII/AAAAAAAAAfM/SBsXDSw2_RA/Plugin%252520Registration%252520Tool_2012-03-19_12-43-20_thumb%25255B1%25255D.png?imgmax=800" width="244" height="65" /></a></p><br /><br /><br /><br /><p>Now our assembly is registered and our plugin will run for create messages on the lead entity. Go to the CRM web interface and create a new lead, save it, open it again and see the Auto Number populated.</p><br /><br /><p>In this post we explored the plug-in basics, and developed a simple plug-in. To complete the picture, you also explored how to register our plug-in into Dynamics CRM and see it in action.</p>  